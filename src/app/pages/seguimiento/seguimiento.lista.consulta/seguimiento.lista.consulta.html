<!-- Paginación -->
<div class="d-flex align-items-center justify-content-between mt-2 pager-wrap"
     [class.is-loading]="loading"
     style="user-select: none;">
  <div class="text-muted small">
    Página {{ shownPage }} de {{ shownLastPage }} —
    Mostrando
    <span class="num-range">
      @if (shownFrom > 0) { {{ shownFrom }}&ndash;{{ shownTo }} } @else { 0 }
    </span>
    de <span class="total-num">{{ shownTotal }}</span>
  </div>

  <ul class="pagination m-0" style="user-select: none;">
    <li class="page-item" [class.disabled]="page === 1 || loading">
      <button class="page-link" (click)="goTo(page - 1)" [disabled]="page === 1 || loading">Anterior</button>
    </li>
    <li class="page-item" [class.disabled]="page >= lastPage || loading">
      <button class="page-link" (click)="goTo(page + 1)" [disabled]="page >= lastPage || loading">Siguiente</button>
    </li>
  </ul>
</div>

<!-- Contenido -->
<div [formGroup]="form" class="card card--flat" [attr.aria-busy]="loading">
  <div class="card-body p-0 lista-wrap"
       [class.is-loading]="loading"
       [class.skeleton-mode]="firstLoad"
       [style.--list-min.px]="listMinHeight"
       [style.--row-min.px]="rowSlotPx"
       [style.--row-gap.px]="rowGapPx"
       style="position: relative; min-height: var(--list-min);">

    <div class="stack">
      <!-- PRIMERA CARGA: SKELETON -->
      @if (firstLoad) {
        @for (_ of skeletons; track $index) {
          <article class="seguimiento-card" style="--fecha-minch: 28ch; --ta-rows: 2;">
            <header class="cabecera">
              <div class="id">Seguimiento #</div>
              <div class="acciones">
                <button type="button" class="btn btn-sm btn-outline-secondary" disabled>Editar</button>
              </div>
              <span class="fecha"><span class="fecha-box placeholder"></span></span>
            </header>
            <div class="contenido">
              <div class="skeleton-area">
                <div class="skeleton-line mb-2"></div>
                <div class="skeleton-line mb-2"></div>
                <div class="skeleton-line w-75"></div>
              </div>
            </div>
          </article>
        }
      } @else {

        <!-- LISTA REAL -->
        @if (items.length > 0 && rows.length === items.length) {
          <div formArrayName="rows" class="stack">
            @for (c of items; track c.id; let i = $index) {
              <article class="seguimiento-card" style="--fecha-minch: 28ch; --ta-rows: 2;" [formGroupName]="i">
                <header class="cabecera">
                  <div class="id">Seguimiento #{{ c.id }}</div>

                  <div class="acciones d-flex gap-2">
                    @if (!isEditingRow(c.id)) {
                      <button type="button"
                              class="btn btn-sm btn-outline-secondary"
                              (click)="onEdit(i, $event)">Editar</button>
                    } @else {
                      <button type="button" class="btn btn-sm btn-warning" (click)="onCancel(i)">Cancelar</button>
                      <button type="button" class="btn btn-sm btn-success" (click)="onSave(i)">Guardar</button>
                    }
                  </div>

                  <time class="fecha text-muted">
                    <span class="fecha-box">{{ c.fecha_formato }}</span>
                  </time>
                </header>

                <div class="contenido">
                  <textarea formControlName="cuerposeguimiento"
                            class="form-control"
                            rows="2"
                            placeholder="Escriba el seguimiento…"></textarea>
                </div>
              </article>
            }
          </div>
        }

        <!-- VACÍO estable (solo cuando NO está cargando) -->
        @if (showEmpty && !loading) {
          <div class="text-center text-muted estado-vacio fullheight">
            No se encontraron resultados.
          </div>
        }
      }
    </div>

    <!-- OVERLAY: cargas posteriores -->
    @if (showOverlay  && items.length > 0 ) {
      <div class="loading-overlay d-flex align-items-center justify-content-center">
        Cargando…
      </div>
    }
  </div>
</div>

